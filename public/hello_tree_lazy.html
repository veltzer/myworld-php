<html>
	<!-- TODO
		- move this model into ints own .js file as a new dojo component
		- can't I just get ridd of my forrest model? will it not work out
			of the box without it ?
	-->
	<head>
		<title>Hello, Lazy Tree!</title>
		<script src='dojo/dojo/dojo.js' djConfig='parseOnLoad:true'></script>
		<style type='text/css'>
			@import 'dojo/dijit/themes/tundra/tundra.css';
			@import 'dojo/dojo/resources/dojo.css';
		</style>
		<script type='text/javascript' language='Javascript'>
			dojo.require('dijit.tree.ForestStoreModel');
			dojo.require('dojox.data.QueryReadStore');
			dojo.require('dijit.Tree');
			dojo.provide('my.ForestStoreModel');
			dojo.declare('my.ForestStoreModel', dijit.tree.ForestStoreModel, {
				startup:function() {
					return this.inherited(arguments);
				},
				getChildren: function(parentItem, complete_cb, error_cb) {
					var mypath
					if (parentItem.root == true) {
						mypath = this.rootId;
					}
					else {
						mypath = this.store.getValue(parentItem, 'path');
					}
					this.store.fetch({ query: {path: mypath},
						onComplete: complete_cb,
						onError: error_cb
					});
					return;
				}
			});
			function do_click(item,node) {
				var w_tree=dijit.byId('mytree');
				console.debug('you clicked: ' + w_tree.model.getLabel(item));
			}
		</script>
	</head>
	<body class='tundra'>
		<div dojoType='dojox.data.QueryReadStore'
		url='hello_tree_lazy.php'
		jsId='treeStore'
		/>
		<!--
		<div dojoType='dijit.tree.ForestStoreModel'
			query='{ path: "/" }'
		-->
		<div dojoType='my.ForestStoreModel'
			store='treeStore'
			rootLabel='myLabel'
			rootId='./'
			jsId='treeModel'
		/>
		<div dojoType='dijit.Tree'
			onClick='do_click'
			model='treeModel'
			jsId='itemTree'
			persist='false'
			id='mytree'
		/>
	</body>
</html>
